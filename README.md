# 🦊 Light Fox Manga - Supabase Edition

Полноценная платформа для манги и аниме с серверной архитектурой на Supabase.

## 🚀 Возможности

### ✅ Серверная архитектура:
- 🗄️ **PostgreSQL база данных** (Supabase)
- 🔐 **Безопасная авторизация** (Supabase Auth)
- 📁 **Файловое хранилище** (Supabase Storage)
- ⚡ **Real-time обновления**
- 🌍 **Геоблокировка** определенных стран

### 📚 Функционал:
- 📖 **Каталог манги/аниме** с фильтрами
- 🎬 **Видео плеер** для просмотра
- 💬 **Комментарии** с автомодерацией
- ⭐ **Рейтинговая система**
- 💰 **Донаты** через Stripe
- 💎 **Система подписок**
- 🔔 **Уведомления** о новых сериях
- 👤 **Личные кабинеты**

## 🛠️ Настройка

### 1. Настройка Supabase:

1. Создайте проект на [supabase.com](https://supabase.com)
2. Скопируйте URL и Anon Key
3. Создайте файл `.env`:

```bash
cp .env.example .env
```

4. Заполните переменные в `.env`:

```env
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key
```

### 2. Установка зависимостей:

```bash
npm install
```

### 3. Применение миграций:

Миграции находятся в папке `supabase/migrations/` и применяются автоматически при подключении к Supabase.

### 4. Настройка Storage:

В Supabase Dashboard создайте buckets:
- `avatars` - для аватаров пользователей
- `manga-covers` - для обложек манги
- `videos` - для видео файлов

### 5. Настройка геоблокировки:

Edge Function `geo-restriction` автоматически блокирует доступ из:
- 🇰🇷 Южной Кореи
- 🇩🇪 Германии  
- 🇨🇳 Китая
- 🇯🇵 Японии

## 🚀 Запуск

### Разработка:
```bash
npm run dev
```

### Продакшен:
```bash
npm run build
npm start
```

## 📊 Структура базы данных

### Таблицы:
- `users` - Пользователи и профили
- `manga` - Каталог манги/аниме
- `episodes` - Серии и видео
- `comments` - Комментарии пользователей
- `ratings` - Рейтинги и оценки
- `donations` - История донатов
- `notifications` - Уведомления
- `manga_subscriptions` - Подписки на уведомления
- `user_lists` - Пользовательские списки

### Storage Buckets:
- `avatars` - Аватары пользователей
- `manga-covers` - Обложки тайтлов
- `videos` - Видео файлы

## 🔧 Edge Functions

### Развернутые функции:
- `geo-restriction` - Геоблокировка по странам
- `process-payment` - Обработка платежей Stripe
- `send-notifications` - Отправка уведомлений
- `moderate-comments` - Автомодерация комментариев

## 🛡️ Безопасность

### Row Level Security (RLS):
- ✅ Пользователи видят только свои данные
- ✅ Админы имеют полный доступ
- ✅ Гости видят только публичный контент
- ✅ Автоматическая модерация контента

### Геоблокировка:
- 🚫 Автоматическая блокировка по IP
- 🚫 Сообщения на языке страны
- 📊 Логирование попыток доступа

## 💳 Платежи

### Stripe интеграция:
- 💰 Донаты для ускорения тайтлов
- 💎 Оплата подписок
- 🔗 Webhook для подтверждения
- 📊 Аналитика платежей

## 🌍 Многоязычность

### Поддерживаемые языки:
- 🇷🇺 Русский (основной)
- 🇺🇦 Украинский
- 🇬🇧 Английский

### Региональные валюты:
- 🇷🇺 Рубли (₽)
- 🇺🇦 Доллары ($)
- 🇰🇿 Доллары ($)
- 🇧🇾 Доллары ($)

## 📱 Адаптивность

- 📱 **Mobile-first** дизайн
- 💻 **Desktop** оптимизация
- 🎨 **Темная/светлая** тема
- ⚡ **Быстрая загрузка**

## 🔄 Миграция с localStorage

Система автоматически мигрирует данные из localStorage в Supabase при первом подключении.

## 📞 Поддержка

При возникновении проблем:
1. Проверьте настройки Supabase
2. Убедитесь что миграции применены
3. Проверьте переменные окружения
4. Посмотрите логи в консоли браузера

---

**🦊 Light Fox Manga - Теперь с полноценной серверной архитектурой!**