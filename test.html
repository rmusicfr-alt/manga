<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –¥–∞–Ω–Ω—ã—Ö</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-result {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #4CAF50;
        }
        .test-error {
            border-left-color: #f44336;
            background: #ffebee;
        }
        .test-warning {
            border-left-color: #ff9800;
            background: #fff3e0;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        button {
            background: #ff8a50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #ff7043;
        }
        .console-output {
            background: #1e1e1e;
            color: #ffffff;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>ü¶ä –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –¥–∞–Ω–Ω—ã—Ö Light Fox Manga</h1>
    
    <div id="testResults"></div>
    
    <h2>üîß –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞:</h2>
    <div id="consoleOutput" class="console-output">–û—Ç–∫—Ä—ã—Ç–∏–µ –∫–æ–Ω—Å–æ–ª–∏...</div>
    
    <h2>üéÆ –¢–µ—Å—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã:</h2>
    <button onclick="testBasicAPI()">–¢–µ—Å—Ç –±–∞–∑–æ–≤–æ–≥–æ API</button>
    <button onclick="testFilterAPI()">–¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</button>
    <button onclick="testAddManga()">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –º–∞–Ω–≥—É</button>
    <button onclick="clearTestData()">–û—á–∏—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
    <button onclick="refreshPage()">–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</button>

    <script src="js/data.js"></script>
    <script>
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.log –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ HTML
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        const consoleOutput = document.getElementById('consoleOutput');
        
        function addToConsole(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'warn' ? '‚ö†Ô∏è' : '‚úÖ';
            consoleOutput.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToConsole(args.join(' '), 'warn');
        };

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
        function runTests() {
            const results = document.getElementById('testResults');
            results.innerHTML = '';
            
            // –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ MangaAPI
            addTestResult(
                '–ó–∞–≥—Ä—É–∑–∫–∞ MangaAPI',
                !!window.MangaAPI,
                window.MangaAPI ? 'API —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω' : 'API –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω'
            );
            
            // –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
            const mangaCount = window.MangaAPI ? window.MangaAPI.getAllManga().length : 0;
            addTestResult(
                '–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö',
                mangaCount > 0,
                `–ù–∞–π–¥–µ–Ω–æ ${mangaCount} —Ç–∞–π—Ç–ª–æ–≤`
            );
            
            // –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
            if (window.MangaAPI) {
                const filtered = window.MangaAPI.filterManga({ search: '–ø–æ–¥–Ω—è—Ç–∏–µ' });
                addTestResult(
                    '–¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞',
                    filtered.length > 0,
                    `–ü–æ–∏—Å–∫ "–ø–æ–¥–Ω—è—Ç–∏–µ" –≤–µ—Ä–Ω—É–ª ${filtered.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`
                );
            }
            
            // –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∂–∞–Ω—Ä–æ–≤
            if (window.MangaAPI) {
                const genres = window.MangaAPI.getGenres();
                addTestResult(
                    '–ó–∞–≥—Ä—É–∑–∫–∞ –∂–∞–Ω—Ä–æ–≤',
                    genres.length > 0,
                    `–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${genres.length} –∂–∞–Ω—Ä–æ–≤`
                );
            }
            
            // –¢–µ—Å—Ç 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±—ã—Ç–∏–π
            let eventReceived = false;
            window.addEventListener('mangaDataReady', () => {
                eventReceived = true;
                addTestResult(
                    '–°–æ–±—ã—Ç–∏—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö',
                    true,
                    '–°–æ–±—ã—Ç–∏–µ mangaDataReady –ø–æ–ª—É—á–µ–Ω–æ'
                );
            });
            
            setTimeout(() => {
                if (!eventReceived) {
                    addTestResult(
                        '–°–æ–±—ã—Ç–∏—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö',
                        false,
                        '–°–æ–±—ã—Ç–∏–µ mangaDataReady –Ω–µ –ø–æ–ª—É—á–µ–Ω–æ'
                    );
                }
            }, 1000);
        }
        
        function addTestResult(name, success, message) {
            const results = document.getElementById('testResults');
            const div = document.createElement('div');
            div.className = `test-result ${success ? '' : 'test-error'}`;
            div.innerHTML = `
                <strong>${success ? '‚úÖ' : '‚ùå'} ${name}</strong><br>
                ${message}
            `;
            results.appendChild(div);
        }
        
        function testBasicAPI() {
            console.log('=== –¢–µ—Å—Ç –±–∞–∑–æ–≤–æ–≥–æ API ===');
            if (window.MangaAPI) {
                const manga = window.MangaAPI.getAllManga();
                console.log('–í—Å–µ —Ç–∞–π—Ç–ª—ã:', manga);
                console.log('–ü–µ—Ä–≤—ã–π —Ç–∞–π—Ç–ª:', manga[0]);
                console.log('–¢–∞–π—Ç–ª —Å ID 1:', window.MangaAPI.getMangaById(1));
            } else {
                console.error('MangaAPI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
            }
        }
        
        function testFilterAPI() {
            console.log('=== –¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ ===');
            if (window.MangaAPI) {
                console.log('–ü–æ–∏—Å–∫ "–Ω–∞—á–∞–ª–æ":', window.MangaAPI.filterManga({ search: '–Ω–∞—á–∞–ª–æ' }));
                console.log('–§–∏–ª—å—Ç—Ä –ø–æ –∂–∞–Ω—Ä—É "–≠–∫—à–µ–Ω":', window.MangaAPI.filterManga({ genres: ['–≠–∫—à–µ–Ω'] }));
                console.log('–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É:', window.MangaAPI.filterManga({ sortBy: 'rating' }));
            } else {
                console.error('MangaAPI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
            }
        }
        
        function testAddManga() {
            console.log('=== –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –º–∞–Ω–≥–∏ ===');
            if (window.MangaDebug) {
                const newManga = window.MangaDebug.addTestManga();
                console.log('–î–æ–±–∞–≤–ª–µ–Ω–Ω–∞—è –º–∞–Ω–≥–∞:', newManga);
                runTests(); // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã
            } else {
                console.error('MangaDebug –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
            }
        }
        
        function clearTestData() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
                if (window.MangaDebug) {
                    window.MangaDebug.clearAll();
                }
            }
        }
        
        function refreshPage() {
            location.reload();
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            setTimeout(runTests, 500);
        });
        
        // –¢–∞–∫–∂–µ –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
        window.addEventListener('mangaDataReady', () => {
            setTimeout(runTests, 100);
        });
    </script>
</body>
</html>
